<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
		<title>趣味农场</title>
		<link rel="stylesheet" type="text/css" href="__WAP__/bootstrap-3.3.7/dist/css/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="__WAP__/css/header.css" />
		<link rel="stylesheet" type="text/css" href="__WAP__/css/style.css" />
		<link rel="stylesheet" type="text/css" href="__WAP__/css/spirit.css" />
		<link rel="stylesheet" type="text/css" href="__WAP__/css/media_quer.css" />
		<link rel="stylesheet" type="text/css" href="__WAP__/css/media_quer-background.css" />
		<script src="__WAP__/js/jQuery v2.1.1.js"></script>

		<style type="text/css">
			.top,
			.bottom,
			.bottom li {
				width: 100%;
				margin: 1rem 0;
			}

			.top {
				display: flex;
				justify-content: space-around;
				box-sizing: border-box;
				padding: 0 5%;
			}

			.top li {
				width: 45%;
				height: 40px;
				line-height: 40px;
				text-align: center;
				font-size: 1.7rem;
				border-radius: 1.8rem;
				color: #3db4cc;
				border: 1px solid #3db4cc;
				background: #f0f0f3;
				box-sizing: border-box;
				font-weight: 600;
			}

			.top li.active {
				color: #fff;
				background: linear-gradient(to right, #3db4cc, #6fd6ea);
				border: 0;
			}

			.bottom li>div {
				width: 90%;
				margin: 1rem auto;
			}

			.figure,
			.pay_detail {
				background-color: white;
				height: 50px;
				position: relative;
				border-radius: 5px;
			}

			.figure span {
				position: absolute;
				top: 0;
				left: 0;
				line-height: 50px;
				width: 50px;
				text-align: center;
				font-size: 3rem;
			}

			.figure input {
				width: 100%;
				height: 100%;
				line-height: 50px;
				box-sizing: border-box;
				padding-left: 50px;
				font-size: 1.8rem;
			}

			.figure_text .fl1,
			.pay_detail {
				display: flex;
				position: relative;
			}

			.inline_pay_img_show {
				height: 50px;
				width: 50px;
				padding: 5px;
				box-sizing: border-box;
			}

			.inline_pay_name {
				line-height: 50px;
				font-size: 1.8rem;
			}

			.img_ri {
				width: 26px;
				height: 26px;
				position: absolute;
				top: 12px;
				right: 1rem;
			}

			.figure_text {
				color: #a9a9a9;
			}

			.big-a {
				color: #3db4cc;
				text-align: center;
				font-size: 1.50rem;
			}

			.pay_detail1 {
				padding: 0.5rem 1rem;
				color: #fff;
				background: linear-gradient(to right, #3db4cc, #6fd6ea);
				border-radius: 0.45rem;
			}

			.pay_detail1 h5,
			.pay_detail1 ul,
			.pay_detail1 ul li {
				width: 100%;
			}

			.pay_detail1 h5 {
				text-align: center;
				line-height: 3rem;
				font-size: 2rem;
			}

			.pay_detail1 ul li {
				overflow: hidden;
			}

			.pay_detail1 ul li p {
				float: left;
				font-size: 1.5rem;
			}

			.pay_detail1 ul li p:nth-child(1) {
				width: 25%;
				text-align: right;
			}

			.pay_detail1 ul li p:nth-child(2) {
				width: 70%;
			}

			.a_ophen {
				display: block;
				width: 90%;
				margin: 0 auto;
				border: 1px solid #ededed;
				border-radius: 0.45rem;
				padding: 1.1rem 1.50rem;
				background: #fff;
				margin-top: 0.45rem;
				overflow: hidden;
			}

			.portrait {
				width: 50px;
				height: 50px;
				background: url(__WAP__/img/e.png) no-repeat center center;
				background-size: 2.5rem;
				margin-right: 1rem;
			}

			.telephone {
				font-size: 1.50rem;
				color: #3db4cc;
				line-height: 2.50rem;
			}

			.work_time {
				font-size: 1.2rem;
				color: #a9a9a9;
				line-height: 1.50rem;
			}

			.big-a {
				color: #3db4cc !important;
				padding: 0.5rem 0;
				font-size: 14px;
				flex-wrap: 600;
			}
		</style>
	</head>

	<body>
		<div class="wrapper">
			<div class="header">
				<div class="">
					<span class="icon"></span><span>返回</span>
				</div>
				<h3>充值</h3>
				<a href="{:url('member/paylog')}">充值记录</a>
			</div>
			<ul class="top">
				<li class="active">线上充值</li>
				<li>对公转账</li>
			</ul>

			<ul class="bottom">
				<li>
					<div class="figure">
						<span>￥</span>
						<input id="money1" type="number" placeholder="请输入充值金额" oninput="if(value.length>7)value=value.slice(0,7)" step="0" style="ime-mode:disabled" oninput="if(value.length>7)value=value.slice(0,7)"  onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"  onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'0')}else{this.value=this.value.replace(/\D/g,'')}">
					</div>
					<div class="figure_text">
						<div id="purchase" class="fl1">
							<!--充值金额禁止小数，-->充值金额可购常规鹅：<i id="num-sheep">0</i>只</div>
					</div>

					<div class="pay_detail clearfix">

						<div class="inline_pay_img_show">
							<img src="__WAP__/img/57c78add65bf8.jpg" height="100%" width="100%">
						</div>

						<div class="inline_pay_name">
							微信手机WAP支付 </div><img class="img_ri" src="__WAP__/img/dui.png" />
					</div>
					<div class="figure_text">
						温馨提示：当您在工作日内申请提现次日到账，节假日申请提现延顺到账。您申请提现时我们将收取{$lilv*100}%手续费噢 ∩_∩。
					</div>
					<button class="big-button press" id="big-button" onclick="reward()">朕要充值</button>
					<a href="{:url('member/paygz')}" class="big-a">充值、提现规则</a>

				</li>
				<li style="display: none;">
					<div class="pay_detail1">
						<h5>平安银行</h5>

						<ul>
							<li>
								<p>收款人：</p>
								<p>王肖华</p>
							</li>
							<li>
								<p>开户行：</p>
								<p>平安银行郑州分行营业部</p>
							</li>
							<li>
								<p>账户：</p>
								<p>6230580000027911705</p>
							</li>
							<li>
								<p>时间：</p>
								<p>周一至周五 8:30 - 17:30</p>
							</li>
						</ul>

					</div>

					<div class="figure_text">
						为确保充值顺利，请您联系客服，并用网银（或到银行柜台）转账到该账户，我们会尽快进行确认。
					</div>
					<a href="#" class="a_ophen">
						<div class="portrait fl"></div>
						<div class="cstn fl">
							<p class="telephone">客服电话：136-138-20359</p>
							<p class="work_time">周一至周五 8:30 - 17:30</p>
						</div>
					</a>

				</li>
			</ul>

		</div>
		<p class="overtop"></p>
		<span id="val" style="position: fixed; top: 50%;opacity: 0;"></span>
		<div class="background"></div>
		<script src="__WAP__/js/header.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			/*禁止输入小数*/
			$(document).ready(function() {
				var ipt = $("#money1");
				ipt.on('keyup', function() {
					if(!/^\d+$/.test(this.value)) {
						this.value = '';
					}
				})
			});

			$("#money1").bind('input', function() {
				$("#val").text(parseInt($(this).val()));
				$(this).val("");
				$(this).val($("#val").text());
			})

			$(".top li").click(function() {
				tt = $(".top li").index($(this));
				$(".top li").removeClass("active");
				$(this).addClass("active");
				$(".bottom>li").css("display", "none");
				if(tt == 0) {
					$(".bottom>li:nth-child(1)").css("display", "block");
				} else if(tt == 1) {
					$(".bottom>li:nth-child(2)").css("display", "block");
				}
			})
			$("#money1").bind('input', function() {
				/*$(this).val(Math.abs($(this).val()));*/
				if($("#money1").val() ==""){

				$("#num-sheep").text("0");
				}else{
					var va = parseInt($("#money1").val()) / 80;
				/*充值除以单价*/
				$("#num-sheep").text(parseInt(va));
				}

			})
		</script>
		<script type="text/javascript">
			function reward(money) {

				if(Math.abs($("#money1").val()) != 0) {

					$("#big-button").attr({
						"disabled": "disabled"
					});
					var ua = navigator.userAgent.toLowerCase(); //获取判断用的对象
					if(ua.match(/MicroMessenger/i) != "micromessenger") {
						$(".overtop").text("请在微信中打开");
						$("#big-button").removeAttr("disabled");
						overtop();
						return false;
					}
					var authentication = "{:session('user.authentication')}";
					if (authentication != 2) {
						$(".overtop").text("请实名认证后再充值");
						$("#big-button").removeAttr("disabled");
						overtop();
						return false;
					}

					var money = $("#money1").val(); //充值金额
					if(money == '') {
						$(".overtop").text("请输入充值金额");
						$("#big-button").removeAttr("disabled");
						overtop();
						return false;
					}
					var openid = "{:session('user.openid')}";
					if (openid=='') {
						$(".overtop").text("正在获取微信授权");
						$("#big-button").removeAttr("disabled");
						overtop();
						window.location = '{:url("login/wxlogin");}';
						return false;
					}
					$.ajax({
						//一个Ajax过程
						type: "post", //以post方式与后台沟通
						url: "{:url('wxpay/getinfo')}", //与此php页面沟通
						dataType: 'json', //从php返回的值以 JSON方式 解释
						data: {
							'money': money
						}, //发给php的数据有两项，分别是上面传来的u和p
						success: function(json) {
							//var data=JSON.stringify(json);
							//console.log(json.appId);

							eval('var data = ' + json);
							callpay(data);
						},
						error: function() {
							$(".overtop").text("参数错误");
							$("#big-button").removeAttr("disabled");
							overtop();
						}
					})
				} else {
					$(".overtop").text("充值金额不能为0");
					$("#big-button").removeAttr("disabled");
					overtop();
				}
			}

			function callpay(data) {
				if(typeof WeixinJSBridge == "undefined") {
					if(document.addEventListener) {
						document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
					} else if(document.attachEvent) {
						document.attachEvent('WeixinJSBridgeReady', jsApiCall);
						document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
					}
				} else {
					jsApiCall(data);
				}
			}
			//调用微信JS api 支付
			function jsApiCall(data) {
				WeixinJSBridge.invoke(
					'getBrandWCPayRequest',
					data,
					function(res) {
						WeixinJSBridge.log(res.err_msg);
						console.log(res.err_msg);
						if(res.err_msg == "get_brand_wcpay_request:ok") {
							//成功
							$(".overtop").text("充值成功");
							overtop();
							$("#money1").val(0);
							$("#big-button").removeAttr("disabled");
							setTimeout(function() { //使用  setTimeout（）方法设定定时2000毫秒
								window.location = '{:url("member/paylog");}';
							}, 1500);
						}
						$("#big-button").removeAttr("disabled");
					}
				);
			}

			//调用微信JS api 支付
			// function jsApiCall(data)
			// {
			// 	WeixinJSBridge.invoke(
			// 		'getBrandWCPayRequest',
			// 		data,
			// 		function(res){
			// 			WeixinJSBridge.log(res.err_msg);
			// 			alert(res.err_code+'$'+res.err_desc+'$'+res.err_msg);
			// 		}
			// 	);
			// }

			// function callpay(data)
			// {
			// 	if (typeof WeixinJSBridge == "undefined"){
			// 	    if( document.addEventListener ){
			// 	        document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
			// 	    }else if (document.attachEvent){
			// 	        document.attachEvent('WeixinJSBridgeReady', jsApiCall);
			// 	        document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
			// 	    }
			// 	}else{
			// 	    jsApiCall(data);
			// 	}
			// }
		</script>

	</body>

</html>