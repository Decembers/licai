<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
		<!--<title>我的</title>-->
		<title>趣味农场</title>
		<link rel="stylesheet" type="text/css" href="__WAP__/css/bootstrap-3.3.7/dist/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="__WAP__/css/header.css" />
		<link rel="stylesheet" type="text/css" href="__WAP__/css/style.css" />
		<link rel="stylesheet" type="text/css" href="__WAP__/css/spirit.css" />
		<link rel="stylesheet" type="text/css" href="__WAP__/css/media_quer.css" />
		<link rel="stylesheet" type="text/css" href="__WAP__/css/media_quer-background.css" />
		<script src="__WAP__/js/jQuery v2.1.1.js"></script>
		<style type="text/css">
			@media screen and (max-width: 900px) {
				body {
					background-color: rgb(240, 240, 243);
				}
			}

			.kahao,
			.modular {
				width: 95%;
				margin: 1rem auto;
			}
			/*min-height:100px;//最小高度
max-height:200px;//最大高度*/

			.kahao li {
				box-sizing: border-box;
				height: 70px;
				margin-bottom: 0.5rem;
			}

			.checkin {
				position: relative;
				padding: 1.2rem 0.75rem 1.2rem 3.65rem;
			}

			.white {
				background: #fff;
			}

			.fillet {
				border: 1px solid #ededed;
				border-radius: 0.4rem;
				background: #fff;
			}

			.checkin .bank_icon {
				position: absolute;
				top: 15px;
				left: 20px;
			}

			.bank_icon img {
				margin: 0;
				padding: 0;
				margin-left: -40px;
				transition: All 0.4s ease-in-out;
				-webkit-transition: All 0.4s ease-in-out;
				-moz-transition: All 0.4s ease-in-out;
				-o-transition: All 0.4s ease-in-out;
				transform: rotateY(60deg);
				-webkit-transform: rotateY(60deg);
				-moz-transform: rotateY(60deg);
				-o-transform: rotateY(60deg);
				-ms-transform: rotateY(60deg);
			}

			.kahao li a {
				position: absolute;
				left: 100px;
				top: 10px;
			}

			.detail h6 {
				padding: 0;
				margin: 0;
				color: black;
				font-size: 18px;
				line-height: 30px;
			}

			.detail span {
				font-size: 14px;
				color: gray;
				line-height: 20px;
			}

			body>li {
				display: none;
			}

			.sm_title {
				font-size: 13px;
			}

			.modular {
				padding: 1rem 2rem;
				box-sizing: border-box;
			}

			.infos {
				position: relative;
				box-sizing: border-box;
				height: 3rem;
				border-bottom: 1px solid #ededed;
				margin-bottom: 0.3rem;
			}

			.rmb {
				width: 2.5rem;
				height: 3rem;
				line-height: 3rem;
				font-size: 24px;
				text-align: left;
				position: absolute;
				top: 0;
				left: 0;
			}

			#Jcarry_amount {
				width: 100%;
				font-size: 20px;
				box-sizing: border-box;
				line-height: 3rem;
				padding-left: 2.5rem;
			}

			.info_num {
				font-size: 14px;
				line-height: 30px;
				display: flex;
				width: 100%;
				height: 20px;
			}

			.purchase_tip {
				width: 95%;
				margin: 0.5rem auto;
				font-size: 0.8rem;
				line-height: 1.6rem;
				padding-left: 1.2rem;
				display: flex;
			}
			/*.name {
				display: flex;
				width: 100%;
			}*/
		</style>
	</head>

	<body>
		<div class="wrapper">
			<div class="header">
				<div class="">
					<span class="icon"></span><span>返回</span>
				</div>
				<h3>提现申请</h3>
				<a href="{:url('member/withdrawlog')}">提现记录</a>
			</div>
			<ul class="kahao">
				<li class="checkin white fillet">
					<div class="bank_icon">
						<img src="__WAP__/img/bank/{$arr.image}.jpg" alt="中国工商银行">
					</div>
					<a href="###">
						<div class="detail">
							<h6>{$arr.bank_name}</h6>
							<span>尾号{$arr.cardnum}储蓄卡</span>
						</div>
					</a>
				</li>
			</ul>
			<div class="modular fillet white ">
				<p class="sm_title">提现金额</p>
				<div class="infos clearfix">
					<div class="rmb fl">￥</div>
					<input class="fl" id="Jcarry_amount" type="number" placeholder="提现金额(禁止小数)" style="ime-mode:disabled" oninput="if(value.length>10)value=value.slice(0,10)" >
				</div>
				<p class="info_num" style="color: #3db4cc;">
					<span>可提现：￥</span><span id="ti">{$arr.kbalance}</span>

				</p>
				<p class="a9 info_num">

					<span>账户余额：￥</span><span id="yu">{$arr.balance}</span>
				</p>

			</div>
			<input type="hidden" id="bank_id" value="{$arr.id}">
<!-- 			<p class="purchase_tip a9">
				<input id="Jcarry_purchase" type="hidden" value=""> 注：您的余额还可购买
				<span class="m_co" style="margin: 0;">0</span> 只常规羊。</p> -->
			<button id="add" class="big-button press">朕要提现</button>
</div>
			<p class="overtop"></p>
			<div class="background"></div>
			<script src="__WAP__/js/header.js" type="text/javascript" charset="utf-8"></script>
			<script type="text/javascript">
				$(document).ready(function(){
    var ipt = $("#Jcarry_amount");
    ipt.on('keyup',function(){
        if(! /^\d+$/.test(this.value)){           
        this.value='';
        }
    })
});
				
			sa();

			function sa() {
				/*判断是否为苹果手机*/
				var u = navigator.userAgent;

				var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
				if(isiOS) {
					$(".infos").css("height", "4rem");$(".infos").css("padding", "0.5rem  0");
					$(".rmb").css("top","0.5rem");
				}
			}

				$("#add").click(function() {
					if(Math.abs($("#Jcarry_amount").val())!=0){

					$("#add").attr({"disabled": "disabled"});
					var Jcarry_amount=parseInt($("#Jcarry_amount").val());
					var ti=parseInt($("#ti").text());
					if( Jcarry_amount > ti) {
						$(".overtop").text("提现金额大于可提现金额");
						$("#add").removeAttr("disabled");
						overtop();
					} else {
						if(ti==0) {
						$(".overtop").text("提现金额不可为0");
						$("#add").removeAttr("disabled");
						overtop();return false;
						}
						var bank_id =  $("#bank_id").val();
						var money =  $("#Jcarry_amount").val();
						$.ajax({
		                    type : "POST",  //提交方式
		                    url : "{:url('member/tiwithdraw')}",//路径
		                    data : {
		                        "money" : $("#Jcarry_amount").val(),
		                        "bank_id" : bank_id,
		                    },
		                    dataType : "json",//数据，这里使用的是Json格式进行传输
		                    success : function(result) {
		                    	//alert("请输入用111户名")
								var aa = JSON.parse(result);
								if (aa.code!=1) {
									$("#add").removeAttr("disabled");
									$(".overtop").text(aa.msg);
										overtop();

								}else{
									$(".overtop").text(aa.msg);
									overtop();

									setTimeout(function(){  //使用  setTimeout（）方法设定定时2000毫秒
										$("#Jcarry_amount").val("");
										$("#add").removeAttr("disabled");
										var ti = $("#ti").text() - money;
										$("#ti").text(ti);
									window.location="{:url('member/withdrawlog')}";
									},1000);
								}
		                    },
		                    error : function (){
		                    	$(".overtop").text('请刷新页面重试');
								overtop();
								$("#add").removeAttr("disabled");
		                }
						});
					}
					}else{
						$(".overtop").text("充值金额不能为0");
           		overtop();
					}
				})
				/*function (){
					if($("#yu").text()<$("#ti").text()){
						$(".overtop").text("提现金额大于账户余额");
						overtop();
					}else{
						$(".overtop").text("1");
						overtop();
					}
				}*/
			</script>
	</body>

</html>