<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
		<!--<title>农场超市</title>-->
		<title>趣味农场</title>
		<link rel="stylesheet" type="text/css" href="__WAP__/css/header.css" />
		<link rel="stylesheet" type="text/css" href="__WAP__/css/spirit.css" />
		<link rel="stylesheet" type="text/css" href="__WAP__/css/media_quer.css" />
		<link rel="stylesheet" type="text/css" href="__WAP__/font-awesome-4.7.0/css/font-awesome.min.css" />
		<script src="__WAP__/js/jquery.js"></script>
		<link rel="stylesheet" type="text/css" href="__WAP__/css/media_quer-background.css" />
		<style type="text/css">
			.details {
				width: 95%;
				margin: 0 auto;
				padding-bottom: 10px;
			}

			.detail01,
			.detail02,
			.detail03 {
				border-radius: 0.5rem;
				overflow: hidden;
				background-color: white;
				margin: 0.5rem 0;
			}

			.detail01,
			.detail01 .row,
			.detail01 .row:nth-child(3) img {
				width: 100%;
			}

			.detail01 .row {
				padding: 0 1rem;
				box-sizing: border-box;
			}

			.detail01 .row:nth-child(1) {
				display: flex;
				font-size: 18px;
				line-height: 3rem;
				font-weight: 600;
			}

			.detail01 .row:nth-child(1) span {
				margin-right: 0.5rem;
				flex-wrap: 500;
				color: #1a1a1f;
			}

			.detail01 .row:nth-child(1) .shopname {
				opacity: 0.8;
			}

			.detail01 .row:nth-child(1) #pay_inmoney {
				flex-wrap: 600;
			}

			.detail01 .row:nth-child(2) {
				color: #a9a9a9;
				font-size: 14px;
				line-height: 18px;
			}

			.detail01 .row:nth-child(4) {
				font-size: 15px;
				line-height: 2rem;
				flex-flow: 400;
			}

			.detail02 li {
				width: 100%;
				display: flex;
				justify-content: space-between;
				flex-wrap: wrap;
				line-height: 3rem;
				height: 3rem;
				box-sizing: border-box;
				padding: 0 1rem;
				border-bottom: 1px solid #ededed;
			}

			.detail02 li p {
				display: flex;
			}

			.detail02 li p:nth-child(1) {
				font-size: 0.9rem;
			}

			.detail02 li p:nth-child(2) {
				font-size: 1rem;
			}

			.detail02 li p:nth-child(1) span:nth-child(2) {
				color: gray;
				margin-left: 0.5rem;
			}

			.shu span {
				width: 2.5rem;
				height: 2rem;
				line-height: 2rem;
				text-align: center;
				font-size: 1rem;
				background: #e6e6e6;
				color: #a9a9a9;
				margin-top: 0.5rem;
				border-radius: 0.4rem;
			}

			.shu input {
				width: 2rem;
				text-align: center;
			}

			.detail03 {
				padding: 0.5rem 1rem;
				box-sizing: border-box;
				margin-bottom: 3.5rem;
			}

			.detail03 img {
				width: 100%;
			}

			.detail04 {
				width: 100%;
				position: fixed;
				bottom: 0;
				left: 0;
				height: 3rem;
				background-color: white;
				display: flex;
				    justify-content: space-between;
				    border-top: 1px solid #d9d9d9;
			}

			.detail04 div {
				line-height: 3rem;
				height: 3rem;
				display: flex;
				margin-left: 1rem;
			}

			.detail04 div:nth-child(1) span {
				color: #a9a9a9;
				;
				font-size: 0.9rem;
				/*margin: 0 0.1rem;*/
			}

			.detail04 div:nth-child(1) span.em {
				color: black;
			}

			.detail04 div:nth-child(2) p {
				line-height: 3rem;
				height: 3rem;
				padding: 0 1rem;
				background: linear-gradient(to right, #3db4cc, #6fd6ea);
				color: white;
			}
			.main{
				min-height: 100vh;
				display: none;
			}
.main,
			.main>div {
				width: 100%;
				overflow: hidden;
			}

			.main>div {
				background-color: white;
				margin-bottom: 2px;
				box-sizing: border-box;
				padding: 0.5rem;
			}

			.order p {
				width: 100%;
				text-align: center;
				font-size: 14px;
				line-height: 25px;
				display: flex;
				justify-content: space-between;
			}

			.order p:nth-child(2) {
				/*font-size: 14px;*/
			}
			.order p span:first-child{
				color: gray;
			}
			.blue {
				 color: #6fd6ea !important; font-weight: 600;
     font-size: 15px !important;
			}

			.top>div {
				display: flex;
				border-top: 1px solid #F0F0F3;
				padding: 0.5rem 0;
			}

			.top>div:first-child {
				padding-top: 0;
				border: none;
			}

			.top>div:last-child {
				padding-bottom: 0;
			}

			.top>div>.fa {
				width: 60px;
				text-align: center;
				line-height: 40px;
			}

			.top>div div:nth-child(1) {
				border-right: 1px solid #EBEBEB;
				/* color: #6fd6ea ;*/
			}

			.fa-weixin {
				color: #4BB709;
			}

			.fa-gg-circle {
				 color: #6fd6ea ;
			}

			.top>div .text_fa {
				flex-grow: 3;
			}

			.text_fa p {
				line-height: 20px;
				display: flex;
				padding-left: 1rem;
				font-size: 16px;
			}

			.text_fa p span {
				font-size: 13px;
				opacity: 0.7;
			}

			.text_fa p span.fa {
				line-height: 20px;
				margin-right: 0.5rem;
			}

			.fa-angle-right {
				color: #B2B2B2;
				width: 30px !important;
			}
			/*提示*/
			/*提示*/

			.modal1 {
				width: 80vw;
				position: fixed;
				z-index: 1002;
				left: 50%;
				margin-left: -40vw;
				border-radius: 0.5rem;
				top: 50%;
				margin-top: -60px;
				text-align: center;
				background: #e8e8e8;
				color: #3d4145;
				display: none;
				overflow: hidden;
			}

			.modal1 h5 {
				width: 100%;
				text-align: center;
				margin: 0;
				padding: 0;
				line-height: 40px;
				height: 30px;
				font-size: 16px;
				display: none;
			}

			.modal1 p {
				font-size: 16px;
			}

			.modal1 .modal1_p1 {
				box-sizing: border-box;
				padding: 15px 0;
			}

			.modal1 .modal1_p {
				line-height: 40px;
				display: flex;

				border-top: 1px solid rgba(72,74,74,0.3);
			}

			.modal1 .modal1_p span {
				width: 50%;
				text-align: center;
				padding: 0 .25rem;
				height: 40px;
				line-height: 40px;
				text-align: center;
				color: #0894ec;
				background: #e8e8e8;
				box-sizing: border-box;
			}

			.modal1 .modal1_p span:nth-child(1) {
				border-right: 1px solid rgba(72,74,74,0.3);
			}

			#goodcover {
				display: none;
				position: fixed;
				top: 0;
				left: 0;
				width: 100vw;
				height: 100vh;
				background-color: black;
				z-index: 1001;
				-moz-opacity: 0.65;
				opacity: 0.65;
			}

		</style>
	</head>

	<body>
		<div class="wrapper" id="shopping_mall">
			<div class="header">
				<div class="">
					<span class="icon"></span><span>返回</span>
				</div>
				<h3>农场超市</h3>
				<a href="{:url('Supermarket/gouwuche')}">购物车</a>
			</div>
			<div class="main">
				<div class="order">
					<p><span>商品小计</span><span class="qian">￥405.00</span>
</p>
					<p><span>运费</span><span>￥0.00</span>
</p>
					<p><span>实付费（含运费）</span><span class="blue qian">￥405.00</span>
</p>

				</div>
				<div class="top">
					<div class="wei">
						<div class="fa fa-weixin fa-2x">

						</div>
						<div class="text_fa">
							<p>微信支付</p>
							<p><span class="fa fa-expeditedssl "></span><span>微信安全支付</span></p>
						</div>
						<div class="fa fa-angle-right fa-2x">

						</div>
					</div>
					<div class="yu">
						<div class="fa fa-gg-circle fa-2x">

						</div>
						<div class="text_fa">
							<p>余额支付</p>
							<p><span class="fa ">当前余额</span><span class="blue">￥{$user.balance}</span></p>
						</div>
						<div class="fa fa-angle-right fa-2x">

						</div>
					</div>
				</div>

			</div>
			<input type="hidden" value="{$supermarket.id}" id="sp_id">
			<div class="details">
				<div class="detail01">
					<div class="row">
						<span class="shopname">{$supermarket.name}</span>￥<span id="pay_inmoney">{$supermarket.price}</span>
					</div>
					<div class="row">
						{$supermarket.content}
					</div>
					<div class="row">
						<img src="{$supermarket.image}" id="img">
					</div>
					<!-- <div class="row">
						（包邮）平装礼盒1.37kg
					</div> -->
				</div>
				<ul class="detail02">
					<li>
						<p>资金余额</p>
						<p><span class="em">￥</span><span class="em" style="font-size:1rem;">{$user.balance}</span></p>
					</li>
					<li>
						<p><span>购养数量</span><span>可手动输入</span></p>
						<p class="shu">
							<span id="subtract">-</span>
							<input type="tel" name="" id="number" value="0" maxlength="5" />
							<span id="plus">+</span>
						</p>
					</li>
				</ul>
				<div class="detail03">
					<img src="{$supermarket.content_img}" alt="推荐"/>
				</div>
			</div>
			<div class="detail04">
				<div class="">
					<span>共</span>
					<span class="em" id="numbers">0</span>
					<span>件</span>
					<span>小计</span>
					<span>￥</span>
					<span class="em" id="qian">0.00</span>
				</div>
				<div class="">
					<p  id="gm">朕要购买</p>
				</div>
			</div>

		</div>
		<div class="background"></div>
		<p class="overtop"></p>
		<div class="modal1">
			<h5>提醒</h5>
			<p class="modal1_p1">确定要支付吗？</p>
			<p class="modal1_p"><span class="modal-button">取消</span><span class="modal-button modal-button-bold">确定</span></p>
		</div>
		<div id="goodcover"></div>

		<script src="__WAP__/js/header.js" type="text/javascript" charset="utf-8"></script>
		<script src="__WAP__/js/jquery.fly.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
		var id = {$supermarket.id};
			$("a,input,button").focus(function() {
				this.blur()
			});
var offset = $("#numbers").offset();var img = $("#img").attr("src");
			/*羊数量 - */
			$("#subtract").click(function() {
				var num = parseInt($("#number").val());
				if($("#number").val() == "") {
					num = 0;
					$("#number").val(num);
					bian();
				}
				if(num > 0) {
					$("#number").val(num - 1);
					bian();
					offset ,
						flyer = $("<img class='u-flyer' src='"+img+"'/>");

					flyer.fly({
						start: {
							left: offset.left,
							top: offset.top,
						},
						end: {
							left: event.clientX,
							top: event.clientY
						},
						onEnd: function() {
							this.destory(); //销毁抛物体
						}
					});
				} else {
					$("#number").val("0");
					$(".overtop").text("购买数量不能为负数");
					overtop();
					bian();
				}
			})
			/*羊数量 + */

			$("#plus").click(function() {
				var num = parseInt($("#number").val());
				if($("#number").val() == "") {
					num = 0;
				}
				/*获取羊数量 剩余*/
				if(num >= 5) {
					$("#number").val("5");
					$(".overtop").text("购买数量不能大于5")
					overtop();
					bian();
				} else {
					$("#number").val(num + 1);
					bian();
					offset,
						flyer = $("<img class='u-flyer' src='"+img+"'/>");
					flyer.fly({
						start: {
							left: event.clientX,
							top: event.clientY
						},
						end: {
							left: offset.left,
							top: offset.top,
							width: 20,
							height: 20
						},
						onEnd: function() {
							this.destory(); //销毁抛物体
						}
					});
				}

			})
			/*羊数量输入时时变更*/
			function bian() {
				/*羊只数量 输出*/
				if($("#number").val() == "") {
					$("#numbers").text(0);
				} else {
					$("#numbers").text(Math.abs($("#number").val()));
				}
				tofix($("#qian"), {$supermarket.price}); /*羊总价*/
			}

		/*	function tofix(st, fs) {
				var zong = $("#number").val() * fs;
				var zo = zong.toString();
				var one = zong % 1;
				var one2 = zong % 0.1;
				if(one == 0) {
					st.text(zo + ".00");
				} else {
					if(one2 == 0) {
						st.text(zo + "0");
					} else {
						st.text(zong.toFixed(2));
					}
				}
			}*/
			function tofix(st, fs) {
				var zong = $("#number").val() * fs;
				if(zong % 1 ==0){
					st.text(zong + ".00");
				}else{
					var lens1 =zong.toString().split(".")[1].length;
					if(lens1 == 1) {
							st.text(zong + "0");
						} else if(lens1 == 2) {
							st.text(zong + "0");
						} else if(lens1 > 2) {
							st.text(zong.toString().substr(0, zong.toString().indexOf(".") + 3));
						}
				}
			}
			$("#gm").click(function(){
				if($("#number").val()>0){
					pay_inmoney = $("#pay_inmoney").text();
					qian = $("#number").val()*pay_inmoney;
					$(".qian").text('￥'+qian+'.00');

					$(".details").css("display","none");
					$(".detail04").css("display","none");
					$(".main").css("display","block");
				}else{
					$(".overtop").text("没有购买");
								overtop();
				}
			})
			$(".yu").click(function() {
					/*余额支付*/
					blocks();
			})
			$(".wei").click(function() {
					/*微信支付*/
			})
			/*弹窗确定的删除*/
			$(".modal-button-bold").click(function() {
				nones();
				sp_id = $("#sp_id").val();
				number = $("#number").val();

				qian = $("#pay_inmoney").text() * number;
				if (qian<30) {
						$(".overtop").text("购买金额需在30元以上");
						overtop();return false;
				}

				/*判断余额与订单金额*/
				/*间隔定时器*/

				$.ajax({
				    type : 'POST',
				    url : "{:url('supermarket/infoorder')}",
				    data : {
				    	sp_id:sp_id,
				    	number:number
				    },
				    success : function(data){
				    	if (data.code==1) {
							$(".overtop").text(data.msg);
							overtop();
							window.location.href = "{:url('Supermarket/dingdan')}";

				    	}else{
							$(".overtop").text(data.msg);
							overtop();
				    	}
				    }
				})

				// setTimeout(function(){
				// 	$(".overtop").text("余额不足");
				// 	overtop();
				// },1000)
			});

			/*弹窗*/
			$("#goodcover").click(function() {
				nones();
			})
			$(".modal1_p span:nth-child(1)").click(function() {
				nones();
			})
			/*显示*/
			function blocks() {
				$(".modal1").css("display", "block");
				$("#goodcover").css("display", "block");
			}
			/*隐藏*/
			function nones() {
				$(".modal1").css("display", "none");
				$("#goodcover").css("display", "none");
			}
		</script>
	</body>

</html>